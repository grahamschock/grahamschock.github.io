<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>CSCI 3907: Computation Photography - Project 2: Hybrid Images</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/hljs-github.min.css"/>
  </head>
  <body>
    <article class="markdown-body"><h1 id="csci-3907-computation-photography---project-2-hybrid-images"><a class="header-link" href="#csci-3907-computation-photography---project-2-hybrid-images"></a>CSCI 3907: Computation Photography - Project 2: Hybrid Images</h1>
<h2 id="team-members"><a class="header-link" href="#team-members"></a>Team Members</h2>
<ul class="list">
<li>Jack Umina</li>
<li>Graham Schock</li>
<li>Jonathan Lee</li>
</ul>
<h2 id="background"><a class="header-link" href="#background"></a>Background</h2>
<p>Hybrid images are static images composed of different frequencies of its input images. This gives an illusion of different images depending on the distance the viewer views the image at. The idea is that at close distances, the high frequency elements of an image are clear and distinct. Once the viewer moves away from the image, less and less high frequency components remain and the viewer is only able to make out the lower frequency portions. Hybrid images combine each of these elements from two different photos to create a combination of the two in the ouput. The approach used in this project is described in the <a href="http://cvcl.mit.edu/publications/OlivaTorralb_Hybrid_Siggraph06.pdf">SIGGRAPH 2006 paper</a> by Oliva, Torralba, and Schyns.</p>
<h2 id="main-algorithm"><a class="header-link" href="#main-algorithm"></a>Main Algorithm</h2>
<p>The main idea of the hybrid image alogorithm is to first apply a low pass filter over the first image. This has the effect of bluring the first input image. Next, the second input filter&#39;s image matrix is subtracted by the same images result after have the low pass filter applied. This yields the second input image with a high pass filter applied. The effect here is the second image&#39;s high frequency features are maintained. Finally, the low pass filtered image is averaged with the high pass filtered image to yield the hybrid image.</p>
<h3 id="low-pass-filter"><a class="header-link" href="#low-pass-filter"></a>Low Pass Filter</h3>
<pre class="hljs"><code>low_pass_image = sk.filters.gaussian(img, sigma=sigma, multichannel=<span class="hljs-literal">True</span>)</code></pre><p>The actual implementation of the low pass filter is a guassian blur with a varying sigma. We implemented it such that the sigma coult be changed with each image pairs. Through our experimentation, it was helpful to adjust the sigma depending on each input image. Some images required a smaller sigma to reduce the amount of blue applied so that its features were more easily reconizable in the final hybrid image.</p>
<h3 id="high-pass-filter"><a class="header-link" href="#high-pass-filter"></a>High Pass Filter</h3>
<pre class="hljs"><code>high_pass_image = original_image - apply_low_pass_fltr(img, sigma=sigma)</code></pre><p>The implementation of the high pass filter is taking the original image and subtracting it by the low pass image. This has an effect of producing an image with only the high frequency regions remaining. Similar to the low pass filter, we also found it helpful here to adjust the sigma on a case by case basis. A higher sigma will increase the blur and result in more distinct features in the result of the high pass filter.</p>
<h3 id="frequency-analysis"><a class="header-link" href="#frequency-analysis"></a>Frequency Analysis</h3>
<p>Here we look at the log magnitude of the Fourier transform on each of image of the process. Something particularly interesting is how the low pass filter affects the frequency graph by blurring the input image.</p>
<table>
<thead>
<tr>
<th>Input Image 1</th>
<th>Input 1 with low pass filter</th>
<th>Input Image 2</th>
<th>Input 2 with high pass filter</th>
<th>Hybrid Image</th>
</tr>
</thead>
<tbody><tr>
<td><img src="imgs/pisa-cropped.jpg" alt=""></td>
<td><img src="results/pisa-low.jpg" alt=""></td>
<td><img src="imgs/carrot-cropped.jpg" alt=""></td>
<td><img src="results/carrot-high.jpg" alt=""></td>
<td><img src="results/pisa-carrot.jpg" alt=""></td>
</tr>
<tr>
<td><img src="results/pisa-fa.png" alt=""></td>
<td><img src="results/pisa-low-fa.png" alt=""></td>
<td><img src="results/carrot-fa.png" alt=""></td>
<td><img src="results/carrot-high-fa.png" alt=""></td>
<td><img src="results/hybrid-fa.png" alt=""></td>
</tr>
</tbody></table>
<h3 id="result-comparisons"><a class="header-link" href="#result-comparisons"></a>Result Comparisons</h3>
<table>
<thead>
<tr>
<th>Input Image 1</th>
<th>Input 1 with low pass filter</th>
<th>Input Image 2</th>
<th>Input 2 with high pass filter</th>
<th>Hybrid Image</th>
</tr>
</thead>
<tbody><tr>
<td><img src="imgs/dog-cropped.jpg" alt=""></td>
<td><img src="results/dog-low.jpg" alt=""></td>
<td><img src="imgs/cat-cropped.jpg" alt=""></td>
<td><img src="results/cat-high.jpg" alt=""></td>
<td><img src="results/dog-cat.jpg" alt=""></td>
</tr>
<tr>
<td><img src="imgs/carrot-cropped.jpg" alt=""></td>
<td><img src="results/carrot-low.jpg" alt=""></td>
<td><img src="imgs/pisa-cropped.jpg" alt=""></td>
<td><img src="results/pisa-high.jpg" alt=""></td>
<td><img src="results/carrot-pisa.jpg" alt=""></td>
</tr>
<tr>
<td><img src="imgs/pisa-cropped.jpg" alt=""></td>
<td><img src="results/pisa-low.jpg" alt=""></td>
<td><img src="imgs/carrot-cropped.jpg" alt=""></td>
<td><img src="results/carrot-high.jpg" alt=""></td>
<td><img src="results/pisa-carrot.jpg" alt=""></td>
</tr>
<tr>
<td><img src="imgs/sea-lion-cropped.jpg" alt=""></td>
<td><img src="results/sea-lion-low.jpg" alt=""></td>
<td><img src="imgs/polar-bear-cropped.jpg" alt=""></td>
<td><img src="results/polar-bear-high.jpg" alt=""></td>
<td><img src="results/sea-lion-polar-bear.jpg" alt=""></td>
</tr>
<tr>
<td><img src="imgs/moon-cropped.jpg" alt=""></td>
<td><img src="results/moon-low.jpg" alt=""></td>
<td><img src="imgs/pizza-cropped.jpg" alt=""></td>
<td><img src="results/pizza-high.jpg" alt=""></td>
<td><img src="results/moon-pizza.jpg" alt=""></td>
</tr>
</tbody></table>
<h2 id="automatic-video-generation"><a class="header-link" href="#automatic-video-generation"></a>Automatic Video Generation</h2>
<p>Having a user squint their eyes to be able to visualize a low pass filter is not user friendly.</p>
<p>We decided to implement automatic video generation that would allow the user to see how an image would change if we view the high frequency vs the low frequency. </p>
<h3 id="implementation"><a class="header-link" href="#implementation"></a>Implementation</h3>
<p>To make an image look smaller, while keeping the important data and proportions we decided to use different levels of <a href="https://en.wikipedia.org/wiki/JPEG">jpeg</a> compression.</p>
<p>We use the <a href="https://imagemagick.org/index.php">imagemagik</a> library to compress a hybrid image by a certain percentage to get 80 frames of gradual image compression.</p>
<p>After we compress we want to add padding around the image so that all frames are the same size so we can eventually combine them into a video. We decided to center the image in the frame and fill the rest with black pixels.</p>
<p>After we generate all of the frames we would then combine them into a .gif file with a small delay between each frame and adding more time to the first and last frame so that the user can see the difference between the high pass and the low pass filters. </p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate_frame</span>(<span class="hljs-params">compression_percent, img1, img2</span>):</span>
    hybrid_img = hybrid(img1, img2)
    compress_hybrid = compress(compression_percentage), hybrid_img) <span class="hljs-comment"># ImageMagick function to compress an image by a certain percentage</span>
    <span class="hljs-keyword">return</span> add_padding(compress_hybrid, sizeof(hybrid_img)) <span class="hljs-comment"># Add padding so that all of the frames are the same size</span>
    
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>, <span class="hljs-number">100</span>):
    image_arr.push(generate_frame(i, img1, img2)
</code></pre><h3 id="results"><a class="header-link" href="#results"></a>Results</h3>
<p class="img-container"><img src="movies/cat.gif" alt="Cat and Dog"></p>
<p class="img-container"><img src="movies/pisa.gif" alt="Carrot and Pisa"></p>
<p class="img-container"><img src="movies/pres.gif" alt="GW Preseident and Bear"></p>
<p class="img-container"><img src="movies/moon.gif" alt="Pizza and Moon"></p>
<h2 id="auto-alignment-gui"><a class="header-link" href="#auto-alignment-gui"></a>Auto Alignment GUI</h2>
<p>One tedious part of creating good hybrid images is aligning two images so features match. 
For example, we might want to align the eyes of two animals. We would typically use Photoshop or GIMP 
to manually translate, rotate, and scale the images. We decided to implement a GUI that would automatically transform 
two (user inputted) reference points on two images. We decided to align 2 points, rather than 3, because we can preserve
the aspect ratio of both images without distorting them. The result is shown below. The input images should have the low/high pass filters 
applied already, but for this example, two raw, uncropped images are used.</p>
<p class="img-container"><img src="results/alignment_gui.gif" alt="alignment gif"></p>
<h3 id="the-program"><a class="header-link" href="#the-program"></a>The Program</h3>
<p>The GUI is implemented in Pygame because it supports many of the features we need, such as displaying images
and supporting user input events. A global data structure is used to store the GUI state, such as how many times the 
user has clicked, where they have clicked, and what image is currently displayed.</p>
<h3 id="the-alignment-algorithm"><a class="header-link" href="#the-alignment-algorithm"></a>The Alignment Algorithm</h3>
<ol class="list">
<li>Display the first image. Allow the user to click on two points.</li>
</ol>
<p class="img-container"><img src="results/first_im.png" alt=""></p>
<ol start="2">
<li><p>Display the second image. Allow the user to click on two points.</p>
<p class="img-container"><img src="results/second_im.png" alt=""></p>
</li>
<li><p>Translate the second image</p>
<ol class="list">
<li>Calculate the midpoints between each set of reference points.</li>
</ol>
<p class="img-container"><img src="results/midpoints.png" alt=""></p>
<ol start="2">
<li>Translate the second image so the midpoint overlaps with the midpoint of the first image.</li>
</ol>
</li>
<li><p>Rotate the second image</p>
<ol class="list">
<li>Calculate the slope of both sets of points, and calculate the angle between them.</li>
<li>Rotate the second image by the negative angle in degrees.</li>
</ol>
</li>
<li><p>Scale the second image</p>
<ol class="list">
<li>Calculate the distance between both points in both images and calculate the scaling factor.</li>
<li>Scale the second image by the scaling factor.</li>
</ol>
</li>
<li><p>Display the first image with the transformed second image.</p>
<p class="img-container"><img src="results/result.png" alt=""></p>
</li>
</ol>
    </article>
  </body>
</html>
